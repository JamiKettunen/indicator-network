#!/usr/bin/make -f
# -*- makefile -*-
# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

include /usr/share/dpkg/default.mk

export DPKG_GENSYMBOLS_CHECK_LEVEL = 4

ENABLE_TESTS = ON

@echo DEB_HOST_ARCH $(DEB_HOST_ARCH)
@echo DEB_VENDOR $(DEB_VENDOR)
@echo DEB_DISTRIBUTION $(DEB_DISTRIBUTION)

# disable 'yakkety arm64' + 'yakkety ppc64el'
# for the test failures showing up in the urfkill branch
ifneq (,$(filter $(DEB_HOST_ARCH),arm64 ppc64el))
        ifeq (Ubuntu,$(DEB_VENDOR))
                ifeq (yakkety,$(DEB_DISTRIBUTION))
                        @echo disable $(DEB_DISTRIBUTION) $(DEB_HOST_ARCH)
                        ENABLE_TESTS = OFF
                endif
        endif
endif

# older disabled tests:
# disable arm64, s390x, ppc tests
ifneq (,$(filter $(DEB_HOST_ARCH),arm64 s390x powerpc))
        @echo disable $(DEB_HOST_ARCH)
        ENABLE_TESTS = OFF
endif


%:
	dh $@ --parallel --fail-missing --with python3

override_dh_auto_configure:
	dh_auto_configure -- -DENABLE_TESTS=${ENABLE_TESTS}

